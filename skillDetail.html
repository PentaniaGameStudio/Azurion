<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Compétence — Détail</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* ///summary: page détail, même thème, rendu indenté et champs vides masqués */
:root{--bg:#0f1117;--panel:#151823;--panel2:#1b2030;--txt:#e8ecf1;--mut:#a8b0bf;--bd:#293042}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);
font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Cantarell,"Noto Color Emoji","Segoe UI Emoji","Apple Color Emoji",sans-serif}
.wrap{max-width:900px;margin:24px auto;padding:0 16px}
h1{margin:0 0 12px;font-size:20px}
.toolbar{display:flex;gap:10px;align-items:center;margin:12px 0}
button,.btn{border:1px solid var(--bd);background:var(--panel2);color:var(--txt);padding:8px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
.card{background:var(--panel);border:1px solid var(--bd);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
.detail{padding:16px 16px 24px}
.title{font-size:18px;margin:0 0 6px;display:flex;gap:8px;align-items:baseline}.title .emoji{font-size:26px}.title .name{font-weight:700}.title .lvl{color:var(--mut)}
.kv{margin:8px 0}.k{color:var(--mut)} .indent-1{margin-left:1.25rem}.indent-2{margin-left:2.5rem}
.empty{color:var(--mut);font-style:italic}
/* Couleurs par niveau (Nom en titre) */
.title .name.c-niv1 { color: #ffffff; }
.title .name.c-niv2 { color: #ffa500; }
.title .name.c-niv3 { color: #ff4d4d; }

</style>
</head>
<body>
<div class="wrap">
  <h1>Détail de la Compétence</h1>
  <div class="toolbar">
    <a href="./skillIndex.html" class="btn">Afficher Compétences</a>
    <a href="./skillFamily.html" class="btn">Afficher Familles</a>
  </div>

  <section class="card detail">
    <div id="empty" class="empty">Chargement…</div>
    <div id="view" hidden>
      <h2 class="title">
        <span id="d-emoji" class="emoji"></span>
        <span id="d-name" class="name"></span>
        <span id="d-lvl" class="lvl"></span>
      </h2>
      <div id="d-body"></div>
    </div>
  </section>
</div>

<script>
///summary: récupère ?id=<slug>, cherche la compétence, rend le détail comme dans l’app
const JSON_URL="./skills_data.json";
const params=new URLSearchParams(location.search);
const id=params.get("id");
const slug = s => encodeURIComponent(`${s.family||""}__${s.name||""}`);
const normList = a => (Array.isArray(a)?a:[]).map(s=>typeof s==="string"?s.trim():"").filter(Boolean);

function line(body,label,value,opt={}){
  if(!value) return;
  const d=document.createElement("div"); d.className="kv"+(opt.indent?` indent-${opt.indent}`:"");
  if(opt.raw){ d.textContent=value; } else {
    const k=document.createElement("span"); k.className="k"; k.textContent=label+" ";
    const v=document.createElement("span"); v.textContent=value;
    d.appendChild(k); d.appendChild(v);
  }
  body.appendChild(d);
}

function renderDetail(s){
  document.getElementById("empty").hidden=true; document.getElementById("view").hidden=false;
  document.getElementById("d-emoji").textContent=s.family||"";
  document.getElementById("d-name").textContent=s.name||"";
  // Couleur du nom selon le niveau
  const nameEl = document.getElementById("d-name");
  nameEl.classList.remove("c-niv1","c-niv2","c-niv3");
  const lvl = (s.level || "").toLowerCase();
  nameEl.classList.add(lvl === "niv3" ? "c-niv3" : lvl === "niv2" ? "c-niv2" : "c-niv1");


  document.getElementById("d-lvl").textContent=s.level?`(${s.level})`:"";
  const body=document.getElementById("d-body"); body.innerHTML="";
  line(body,"Coût :",s.cost,{indent:1});
  if(s.difficulty){ line(body,"",s.difficulty,{indent:1,raw:true}); }
  line(body,"Cible :",s.target,{indent:1});
  line(body,"Portée :",s.range_,{indent:1});
  line(body,"Durée :",s.duration,{indent:1});
  line(body,"Dégâts :",s.damage,{indent:1});
  const block=(sing,plur,arr)=>{
    const list=normList(arr);
    if(list.length===1){ line(body,`${sing} :`,list[0],{indent:1}); }
    else if(list.length>1){
      line(body,`${plur} :`,"",{indent:1,raw:true});
      list.forEach(it=>line(body,"",it,{indent:2,raw:true}));
    }
  };
  block("Effet","Effets",s.effects); block("Condition","Conditions",s.conditions); block("Limite","Limites",s.limits);
}

(async function(){
  try{
    const res=await fetch(JSON_URL,{cache:"no-store"}); if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data=await res.json(); const skills=Array.isArray(data)?data:(data.skills||[]);
    skills.forEach(s=>{s.effects=normList(s.effects);s.conditions=normList(s.conditions);s.limits=normList(s.limits);s.level=s.level||"";s.duration=s.duration||"";});
    const found = skills.find(s=>slug(s)===id);
    if(!found){ document.getElementById("empty").textContent="Compétence introuvable."; return; }
    renderDetail(found);
  }catch(e){
    document.getElementById("empty").textContent="Erreur de chargement du JSON.";
    console.error(e);
  }
})();
</script>
</body>
</html>
